@page "/users/delete"
@using Microsoft.AspNetCore.Identity
@using FinalAssignemnt_APDP.Data
@inject UserManager<ApplicationUser> UserManager
@inject NavigationManager NavigationManager

<PageTitle>Delete User</PageTitle>

@if (User is null)
{
	<p class="text-slate-500">Loadingâ€¦</p>
}
else
{
	<div class="max-w-2xl space-y-6">
		<div class="flex items-center gap-4">
			<a href="/users" class="inline-flex items-center rounded-full border border-slate-200 px-3 py-1 text-sm font-semibold text-slate-600 transition hover:border-slate-300 hover:text-slate-900">Back</a>
			<div>
				<h1 class="text-2xl font-semibold text-slate-900">Delete user</h1>
				<p class="text-sm text-slate-500">This action cannot be undone.</p>
			</div>
		</div>

		<div class="rounded-2xl bg-white p-6 shadow-sm">
			<div class="rounded-xl border border-rose-200 bg-rose-50 px-4 py-3 text-sm text-rose-700">
				Are you sure you want to delete <strong class="font-semibold">@User.Email</strong>?
			</div>

			<EditForm OnValidSubmit="DeleteUser" Model="User" FormName="delete-user">
				<div class="mt-6 flex items-center gap-3">
					<button class="inline-flex items-center rounded-full bg-rose-600 px-5 py-2 text-sm font-semibold text-white transition hover:bg-rose-500" type="submit">Delete</button>
					<a class="text-sm font-semibold text-slate-600 hover:text-slate-900" href="/users">Cancel</a>
				</div>
			</EditForm>
		</div>
	</div>
}

@code {
 [SupplyParameterFromQuery]
 public string Id { get; set; } = "";
 private ApplicationUser? User { get; set; }
 protected override async Task OnInitializedAsync()
 {
 if (!string.IsNullOrEmpty(Id))
 {
 User = await UserManager.FindByIdAsync(Id);
 if (User is null) { NavigationManager.NavigateTo("notfound"); return; }
 }
 }

 private async Task DeleteUser()
 {
 if (User is null) return;
 var result = await UserManager.DeleteAsync(User);
 if (!result.Succeeded) { /* TODO: show errors */ return; }
 NavigationManager.NavigateTo("/users");
 }
}
